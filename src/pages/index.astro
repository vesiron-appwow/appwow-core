---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import AppGrid from "../components/AppGrid.astro";
import CategoryFilter from "../components/CategoryFilter.astro";
import apps from "../data/apps.json";
import categories from "../data/categories.json";

const url = new URL(Astro.request.url);
const selected = url.searchParams.get("cat");

const visibleApps = selected
  ? apps.filter(a => a.category === selected)
  : apps;

const featured = visibleApps.filter(a => a.featured);
const others = visibleApps.filter(a => !a.featured);
---
<BaseLayout title="AppWow">
  <Header />

  <main>
    <CategoryFilter categories={categories} selected={selected} />

    <section>
      <h2>Featured Instant Apps</h2>
      <AppGrid apps={featured} />
    </section>

    <section>
      <h2>All Instant Apps</h2>
      <AppGrid apps={others} />
    </section>
  </main>

  <Footer />
</BaseLayout>
